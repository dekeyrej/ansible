- name: postgresql and kubenetes
  hosts: allnodes
  become: yes
  tasks:
  - name: Update cache
    ansible.builtin.apt:
      update_cache: yes
      cache_valid_time: 3600
  - name: Update all packages to their latest version
    ansible.builtin.apt:
      name: "*"
      state: latest
  - name: install postgresql prequisites 
    ansible.builtin.apt:
       pkg:
       - curl
       - ca-certificates
       state: present
       update_cache: yes
  - name: make directory tree for key
    ansible.builtin.shell: |
      install -d /usr/share/postgresql-common/pgdg
      curl -o /usr/share/postgresql-common/pgdg/apt.postgresql.org.asc --fail https://www.postgresql.org/media/keys/ACCC4CF8.asc
  - name: install postgres client stuff
    ansible.builtin.apt_repository:
      repo: deb [signed-by=/usr/share/postgresql-common/pgdg/apt.postgresql.org.asc] https://apt.postgresql.org/pub/repos/apt noble-pgdg main
      state: present
  - name: Update cache
    ansible.builtin.apt:
      pkg: postgresql-client-17
      state: present
      update_cache: yes
  - name: Install pip, venv, kubernetes, psycopg2
    ansible.builtin.apt:
      pkg: 
      # - python3-pip
      # - python3-venv
      - python3-kubernetes
      - python3-psycopg2
      # update_cache: yes
