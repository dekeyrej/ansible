---
- name: python3-kubernetes 
  ansible.builtin.apt:
    pkg: python3-kubernetes

- name: copy config files to tmp
  ansible.builtin.copy:
    src: files/{{ item }}
    dest: /tmp/
  loop: "{{ files }}"

- name: create configmaps 
  kubernetes.core.k8s:
    state: present
    src: /tmp/{{ item }}
  loop: "{{ files }}"

- name: cleanup secrets files
  ansible.builtin.file:
    path: /tmp/{{ item }}
    state: absent
  loop: "{{ files }}"

- name: events data
  kubernetes.core.k8s:
    state: present
    definition: 
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: matrix-events
        namespace: default
      data:
        events.json: "{{ event_data | from_json | to_nice_json }}"
        
