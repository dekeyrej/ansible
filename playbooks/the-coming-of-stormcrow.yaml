# the-coming-of-stormcrow.yaml
# Provisions a Proxmox container and installs MagicMirrorÂ² with Node.js and PM2
# Assumes: Vault and CA are already configured, container image is available

#=== Create Proxmox container for MagicMirror2 ===
- name: Create Proxmox container
  hosts: iluvatar
  vars:
    host_group: watchers
  roles:
    - role: proxmox-container-create
      
      
# performs apt update && apt upgrade; install node.js (LTS); clones and installs MagicMirror2 and defined modules
- name: Setup MagicMirror2
  hosts: gandalf
  roles:
    - role: apt-nodejs-add-source
    - role: apt-update-all
    - role: apt-add-packages
      vars:
        packages: nodejs
    - role: nodejs-pm2-install
    - role: magic-mirror-install

# performs apt update && apt upgrade; pulls and updates MagicMirror2 and defined modules
- name: Update MagicMirror2
  hosts: gandalf
  tags: update
  roles:
    - role: apt-update-all
    - role: magic-mirror-update